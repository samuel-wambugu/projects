{% extends 'main.html' %}
{% load static %}

{% block content %}
<body style="background: #f5f7fa; min-height: 100vh; padding: 20px;">
    <div style="max-width: 1200px; margin: 0 auto;">
        <!-- Header -->
        <div style="background: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <img src="{% static 'base/images/logo.svg' %}" alt="TaskMaster Logo" style="width: 48px; height: 48px; animation: logoFloat 3s ease-in-out infinite;">
                    <h1 style="color: #2c3e50; margin: 0;">📊 Dashboard</h1>
                </div>
                <div style="display: flex; gap: 12px;">
                    <a href="{% url 'userpage' %}" class="btn btn-primary">📝 My Tasks</a>
                    <a href="{% url 'create_task' %}" class="btn btn-success">➕ New Task</a>
                    <a href="{% url 'logoutpage' %}" class="btn btn-danger">🚪 Logout</a>
                </div>
            </div>
        </div>

        <!-- Main Statistics -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number">{{ total_tasks }}</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #50c878;">{{ completed_tasks }}</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #f39c12;">{{ pending_tasks }}</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #e74c3c;">{{ overdue_tasks }}</div>
                <div class="stat-label">Overdue</div>
            </div>
        </div>

        <!-- Completion Rate -->
        <div style="background: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="color: #2c3e50; margin-bottom: 16px;">📈 Completion Rate</h2>
            <div class="progress-bar-container" style="background: #ecf0f1; height: 30px; border-radius: 15px; overflow: hidden;">
                <div class="progress-bar-fill" data-width="{{ completion_rate }}">
                    <span style="color: white; font-weight: bold; font-size: 14px;">{{ completion_rate }}%</span>
                </div>
            </div>
        </div>
        
        <script>
            // Set progress bar width from data attribute
            document.addEventListener('DOMContentLoaded', function() {
                const progressBar = document.querySelector('.progress-bar-fill');
                if (progressBar) {
                    const width = progressBar.getAttribute('data-width');
                    progressBar.style.width = width + '%';
                }
            });
        </script>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 24px;">
            <!-- Priority Breakdown -->
            <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #2c3e50; margin-bottom: 16px;">🎯 Tasks by Priority</h2>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #ffe5e5; border-radius: 8px;">
                        <span style="font-weight: 600; color: #e74c3c;">High Priority</span>
                        <span style="font-size: 20px; font-weight: bold; color: #e74c3c;">{{ high_priority }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #fff3e0; border-radius: 8px;">
                        <span style="font-weight: 600; color: #f39c12;">Medium Priority</span>
                        <span style="font-size: 20px; font-weight: bold; color: #f39c12;">{{ medium_priority }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #e8f5e9; border-radius: 8px;">
                        <span style="font-weight: 600; color: #50c878;">Low Priority</span>
                        <span style="font-size: 20px; font-weight: bold; color: #50c878;">{{ low_priority }}</span>
                    </div>
                </div>
            </div>

            <!-- Category Breakdown -->
            <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #2c3e50; margin-bottom: 16px;">📁 Tasks by Category</h2>
                {% if tasks_by_category %}
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    {% for item in tasks_by_category %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                        <span style="font-weight: 600; color: #2c3e50;">{{ item.categories|title }}</span>
                        <span style="font-size: 20px; font-weight: bold; color: #4a90e2;">{{ item.count }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center;">No category data available</p>
                {% endif %}
            </div>
        </div>

        <!-- Recent and Upcoming Tasks -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
            <!-- Recent Tasks -->
            <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #2c3e50; margin-bottom: 16px;">🕒 Recent Tasks</h2>
                {% if recent_tasks %}
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    {% for task in recent_tasks %}
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #4a90e2;">
                        <a href="{% url 'task_details' task.id %}" style="text-decoration: none; color: #2c3e50; font-weight: 600;">
                            {{ task.title|default:task.description|truncatewords:8 }}
                        </a>
                        <p style="font-size: 12px; color: #7f8c8d; margin: 4px 0 0 0;">{{ task.created_at|date:"M d, Y" }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center;">No recent tasks</p>
                {% endif %}
            </div>

            <!-- Upcoming Tasks -->
            <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h2 style="color: #2c3e50; margin-bottom: 16px;">📅 Upcoming Tasks (Next 7 Days)</h2>
                {% if upcoming_tasks %}
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    {% for task in upcoming_tasks %}
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #50c878;">
                        <a href="{% url 'task_details' task.id %}" style="text-decoration: none; color: #2c3e50; font-weight: 600;">
                            {{ task.title|default:task.description|truncatewords:8 }}
                        </a>
                        <p style="font-size: 12px; color: #7f8c8d; margin: 4px 0 0 0;">Due: {{ task.due_date|date:"M d, Y" }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p style="color: #7f8c8d; text-align: center;">No upcoming tasks</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
{% endblock content %}
